# GitHub Actions workflow to trigger Jenkins pipeline
# This workflow can be triggered manually or on specific events

name: Trigger Jenkins Pipeline

on:
  workflow_dispatch:
    inputs:
      jenkins_job:
        description: 'Jenkins Job Name'
        required: true
        default: 'irctc-monolith-build'
      branch:
        description: 'Branch to build'
        required: false
        default: 'main'
  push:
    branches:
      - main
      - develop
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  trigger-jenkins:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Trigger Jenkins Build
      uses: appleboy/jenkins-action@master
      with:
        url: ${{ secrets.JENKINS_URL }}
        user: ${{ secrets.JENKINS_USER }}
        token: ${{ secrets.JENKINS_TOKEN }}
        job: ${{ github.event.inputs.jenkins_job || 'irctc-monolith-build' }}
        parameters: |
          GIT_BRANCH=${{ github.ref_name }}
          GIT_COMMIT=${{ github.sha }}
          GIT_REPO=${{ github.repository }}
          BUILD_NUMBER=${{ github.run_number }}

    - name: Wait for Jenkins Build
      run: |
        echo "âœ… Jenkins build triggered successfully"
        echo "Job: ${{ github.event.inputs.jenkins_job || 'irctc-monolith-build' }}"
        echo "Check Jenkins dashboard for build status"

